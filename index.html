<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ·ç±³æ¨‚å–®è»Šè³½äº‹èª¿åº¦æ¿(v5.4)</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        /* --- åŸºç¤è¨­å®š --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Microsoft JhengHei", sans-serif; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { overflow: hidden; background-color: #000; width: 100vw; height: 100dvh; display: flex; flex-direction: column; user-select: none; -webkit-user-select: none; }

        /* --- ä¸Šæ–¹å·¥å…·åˆ— --- */
        .top-bar { flex: 0 0 auto; background: #fff; padding-top: max(10px, env(safe-area-inset-top)); padding-bottom: 10px; padding-left: 5px; padding-right: 5px; display: flex; justify-content: space-between; gap: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 3000; }
        .top-btn { flex: 1; border: 2px solid #333; border-radius: 5px; font-weight: bold; font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; height: 40px; background: white; color: #333; }
        .btn-zello { background-color: #ff9800; color: white; border-color: #e65100; }
        .btn-login { background-color: #d32f2f; color: white; border-color: #b71c1c; }

        /* --- åœ°åœ– --- */
        #map-container { flex: 1; position: relative; width: 100%; overflow: hidden; }
        #map { width: 100%; height: 100%; z-index: 0; background: #222; }
        .gps-float-btn { position: absolute; top: 80px; right: 15px; width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.4); z-index: 1000; font-size: 22px; color: #1a73e8; border: 2px solid #fff; }

        /* --- åº•éƒ¨å€åŸŸ --- */
        .bottom-area { flex: 0 0 auto; padding: 5px; padding-bottom: max(20px, env(safe-area-inset-bottom)); background: #000; z-index: 3000; border-top: 1px solid #333; color: white; }

        /* å…¬å‘Šèˆ‡è¨Šæ¯ç‰† */
        .wall-item { background: #000; color: #fff; padding: 8px 12px; margin-bottom: 5px; border-radius: 4px; font-size: 14px; border-left: 4px solid #007bff; display: flex; align-items: center; gap: 8px; }
        #msgWall { border-left-color: #fbc02d; display: none; margin-bottom: 5px; background: #222; border: 1px solid #fbc02d; color: #fbc02d; font-weight: bold; }
        
        /* å…¬å‘Šæ¬„ (å¯é»æ“Š) */
        #publicAnnouncement { 
            background: rgba(0, 0, 0, 0.85); color: #ffeb3b; padding: 10px; border-radius: 6px; font-size: 15px;
            text-align: center; display: block; border: 2px solid #fbc02d; margin-bottom: 5px;
            box-shadow: 0 0 10px rgba(255, 235, 59, 0.2); font-weight: bold; cursor: pointer;
        }

        /* --- ç‹€æ…‹æŒ‰éˆ• (é•·æŒ‰éˆ•è¨­ç½®) --- */
        .status-bar { display: flex; align-items: flex-end; justify-content: space-between; position: relative; margin-top: 5px; width: 100%; gap: 3px; }
        .btn-group { flex: 1; display: flex; gap: 3px; } /* å·¦å³ç¾¤çµ„ */
        
        .status-btn { 
            flex: 1; /* è‡ªå‹•å¡«æ»¿ */
            height: 50px; border: none; border-radius: 5px; color: white; font-weight: bold; font-size: 15px; 
            cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center;
        }
        .status-btn:active { opacity: 0.8; transform: scale(0.98); }
        .st-going { background-color: #d32f2f; } 
        .st-arrived { background-color: #fbc02d; color: black; }
        .st-fixing { background-color: #388e3c; } 
        .st-done { background-color: #1976d2; }

        /* --- PPT æŒ‰éˆ• --- */
        .ppt-wrapper { width: 80px; display: flex; justify-content: center; align-items: center; position: relative; z-index: 3100; flex-shrink: 0; }
        .ppt-container { display: flex; flex-direction: column; align-items: center; transform: translateY(-15px); }
        .ppt-btn { 
            width: 80px; height: 80px; background: radial-gradient(circle, #4a90e2 0%, #1e4a7a 100%); 
            border: 5px solid #fff; border-radius: 50%; color: white; font-weight: bold; 
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.7); cursor: pointer; font-size: 18px; 
        }
        .ppt-btn.talking { background: radial-gradient(circle, #ff5252 0%, #b71c1c 100%); box-shadow: 0 0 25px #ff5252; border-color: #ffcccc; }
        .ppt-label { color: #fff; font-size: 11px; margin-top: 5px; font-weight: bold; }

        /* --- ç®¡ç†é¸å–® (æ¨£å¼å„ªåŒ–) --- */
        .dropdown-menu { position: fixed; top: 60px; left: 10px; background: #3b78c4; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.9); display: none; flex-direction: column; width: 260px; max-height: 80vh; overflow-y: auto; z-index: 5000; border: 2px solid white; }
        .menu-header { background: #1e4a7a; color: white; padding: 12px; font-weight: bold; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.3); }
        .menu-item { padding: 14px; border-bottom: 1px solid rgba(255,255,255,0.2); color: white; font-size: 15px; cursor: pointer; display: flex; align-items: center; font-weight: bold; gap: 10px; }
        .menu-item:active { background: rgba(0,0,0,0.2); }
        .admin-only { display: none !important; }

        /* --- èŠå¤©å®¤ --- */
        .chat-window { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; height: 50vh; background: rgba(0, 0, 0, 0.95); border: 2px solid #007bff; border-radius: 12px; color: white; display: none; flex-direction: column; z-index: 5000; box-shadow: 0 20px 50px rgba(0,0,0,0.9); }
        .chat-header { background: #007bff; padding: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; font-size: 14px; }
        .chat-input-area { display: flex; padding: 10px; background: #222; gap: 8px; }
        .chat-input-area input { flex: 1; padding: 10px; border-radius: 5px; border: none; font-size: 16px; }
        .chat-input-area button { border: none; padding: 0 20px; border-radius: 5px; background: #28a745; color: white; font-weight: bold; }
        .chat-link { color: #4fc3f7; text-decoration: underline; }

        /* é ­åƒ */
        .user-avatar-icon { background-color: #007bff; color: white; border: 2px solid white; border-radius: 50%; text-align: center; line-height: 36px; font-weight: bold; font-size: 18px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); width: 40px; height: 40px; }
        .status-label { background: white; border: 1px solid #ccc; border-radius: 4px; padding: 2px 6px; font-size: 12px; color: #333; font-weight: bold; position: absolute; top: -20px; left: 50%; transform: translateX(-50%); white-space: nowrap; }
    </style>
</head>
<body>

    <div class="top-bar">
        <button id="menuBtn" class="top-btn" onclick="toggleMenu()"><i class="fa-solid fa-gear"></i> ç®¡ç†é¸å–®</button>
        <button class="top-btn" onclick="toggleChat()"><i class="fa-solid fa-comments"></i> èŠå¤©å®¤</button>
        <button id="loginBtn" class="top-btn" onclick="handleGoogleLogin()">
            <i class="fa-solid fa-user"></i> ç™»å…¥
        </button>
    </div>

    <div id="map-container">
        <div id="map"></div>
        <div class="gps-float-btn" onclick="locateUser()"><i class="fa-solid fa-crosshairs"></i></div>
    </div>

    <div class="bottom-area">
        <div id="msgWall" class="wall-item">
            <i class="fa-solid fa-user-shield"></i> ã€ç®¡ç†å“¡ã€‘ç›£æ§æ¨¡å¼é–‹å•Ÿä¸­
        </div>
        
        <div id="publicAnnouncement" onclick="editAnnouncement()">ğŸ“¢ å…¬å‘Šï¼šè«‹ç™»å…¥ä»¥é–‹å§‹ä½¿ç”¨</div>
        
        <div class="status-bar">
            <div class="btn-group">
                <button class="status-btn st-going" onclick="setStatus(this, 'å‰å¾€ä¸­', '#d32f2f')">å‰å¾€ä¸­</button>
                <button class="status-btn st-arrived" onclick="setStatus(this, 'å·²æŠµé”', '#fbc02d')">å·²æŠµé”</button>
            </div>
            <div class="ppt-wrapper">
                <div class="ppt-container">
                    <div class="ppt-btn" id="pptBtn">PPT</div>
                    <div class="ppt-label">ç¶²è·¯ç„¡ç·šé›»</div>
                </div>
            </div>
            <div class="btn-group">
                <button class="status-btn st-fixing" onclick="setStatus(this, 'ç¶­ä¿®ä¸­', '#388e3c')">ç¶­ä¿®ä¸­</button>
                <button class="status-btn st-done" onclick="setStatus(this, 'å·²å®Œæˆ', '#1976d2')">å·²å®Œæˆ</button>
            </div>
        </div>
    </div>

    <div id="dropdownList" class="dropdown-menu">
        <div class="menu-header">ç®¡ç†å“¡ä¸‹æ‹‰é¸å–®</div>
        
        <div class="menu-item admin-only" onclick="alert('åŠŸèƒ½: ç·¨è¼¯ç®¡ç†å“¡')">
            <i class="fa-solid fa-user-shield"></i> 1. ç·¨è¼¯ç®¡ç†å“¡(æ–°å¢/åˆªé™¤)
        </div>
        <div class="menu-item admin-only" onclick="alert('åŠŸèƒ½: ç·¨è¼¯æˆå“¡')">
            <i class="fa-solid fa-users"></i> 2. ç·¨è¼¯æˆå“¡(æ–°å¢/ä¿®æ”¹/åˆªé™¤)
        </div>
        
        <div class="menu-item admin-only" style="flex-wrap: wrap;">
            <div style="width:100%"><i class="fa-solid fa-map"></i> 3. åœ°åœ–ç®¡ç†(GPXåŒ¯å…¥/åˆªé™¤)</div>
            <input type="file" id="gpxInput" accept=".gpx" onchange="loadGPX(this)" style="margin-left: 25px; color: white;">
            <span onclick="removeGPX()" style="margin-left: 25px; color: #ffcccc; cursor: pointer;">[åˆªé™¤GPX]</span>
        </div>

        <div class="menu-item admin-only" onclick="exportChatXLS()">
            <i class="fa-solid fa-comments"></i> 4. èŠå¤©å®¤ç®¡ç†(åŒ¯å‡º/åˆªé™¤)
        </div>
        <div class="menu-item admin-only" onclick="exportWallLogXLS()">
            <i class="fa-solid fa-clipboard-list"></i> 5. è¨Šæ¯ç‰†ç®¡ç†(åŒ¯å‡º/åˆªé™¤)
        </div>
        
        <div style="background:#2c5d9e; padding:5px; color:#ddd; font-size:12px; text-align:center;">å€‹äººè¨­å®š</div>
        <div class="menu-item" onclick="changeNickname()">
            <i class="fa-solid fa-pen"></i> ä¿®æ”¹æš±ç¨±
        </div>
        <div class="menu-item" style="justify-content:center; background:#1e4a7a;" onclick="toggleMenu()">â–² é—œé–‰é¸å–®</div>
    </div>

    <div id="chatWindow" class="chat-window">
        <div class="chat-header">
            <span><i class="fa-solid fa-comments"></i> åœ˜éšŠèŠå¤©å®¤</span>
            <span style="cursor:pointer; font-size:20px;" onclick="toggleChat()">Ã—</span>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input-area">
            <input type="text" id="msgInput" placeholder="è¼¸å…¥è¨Šæ¯...">
            <button onclick="sendMsg()">å‚³é€</button>
        </div>
    </div>

    <audio id="sndDoorbell" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
    <audio id="sndMSN" src="https://assets.mixkit.co/active_storage/sfx/2346/2346-preview.mp3"></audio>
    <audio id="sndBike" src="https://assets.mixkit.co/active_storage/sfx/1857/1857-preview.mp3"></audio>
    <audio id="sndPtt" src="https://assets.mixkit.co/active_storage/sfx/2569/2569-preview.mp3"></audio>

    <script>
        // ==========================================
        //  è«‹å‹™å¿…åœ¨æ­¤å¡«å…¥æ‚¨çš„ API Key
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyB_uFmhh4ENTSHo1oGCW8vEUymDy56c4PE",
            authDomain: "jamielove-map.firebaseapp.com",
            databaseURL: "https://jamielove-map-default-rtdb.firebaseio.com",
            projectId: "jamielove-map",
            storageBucket: "jamielove-map.firebasestorage.app",
            messagingSenderId: "971633917617",
            appId: "1:971633917617:web:95c1b6c57ebc3a530bac90",
        };

        // --- åˆå§‹åŒ– ---
        if (typeof firebase !== 'undefined' && !firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        var db = firebase.database();
        var auth = firebase.auth();
        var provider = new firebase.auth.GoogleAuthProvider();

        // --- å…¨åŸŸè®Šæ•¸ ---
        var map;
        var myUid = null;
        var isAdmin = false;
        var userNickname = "è¨ªå®¢";
        var markers = {};
        var polylines = {};
        var currentGpxLayer = null;

        window.onload = function() {
            try {
                // åœ°åœ–è¼‰å…¥
                map = L.map('map', { zoomControl: false }).setView([24.1477, 120.6736], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
                
                // ç¶å®šæŒ‰éˆ•èˆ‡ç™»å…¥
                setupPPT();
                startAuthListener();
            } catch(e) {
                console.error(e);
                alert("ç³»çµ±è¼‰å…¥éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
            }
        };

        // --- æ¬Šé™é‚è¼¯ ---
        function startAuthListener() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    myUid = user.uid;
                    userNickname = user.displayName;
                    document.getElementById('loginBtn').innerHTML = '<i class="fa-solid fa-right-from-bracket"></i> ç™»å‡º';
                    
                    // 1. ç™»å…¥éŸ³æ•ˆ (é–€éˆ´è²)
                    playSnd('sndDoorbell');

                    // 2. æ›´æ–°ä½ç½®
                    db.ref('users/' + myUid).update({ 
                        nickname: userNickname, 
                        lastSeen: firebase.database.ServerValue.TIMESTAMP 
                    });

                    // 3. æª¢æŸ¥ç®¡ç†å“¡ (å¿…é ˆå½ˆçª—)
                    checkAdminStatus();
                } else {
                    myUid = null;
                    disableAdminMode();
                    document.getElementById('loginBtn').innerHTML = '<i class="fa-solid fa-user"></i> ç™»å…¥';
                    document.getElementById('publicAnnouncement').innerText = "ğŸ“¢ è«‹å…ˆç™»å…¥ Google å¸³è™Ÿ";
                }
            });
        }

        function checkAdminStatus() {
            db.ref('admins/' + myUid).once('value').then(snapshot => {
                let isRegistered = (snapshot.exists() && snapshot.val() === true);
                // ç„¡è«–æ˜¯å¦è¨»å†Šéï¼Œéƒ½å»¶é²åŸ·è¡Œä¸€æ¬¡å¯†ç¢¼è©¢å•é‚è¼¯ï¼Œç¢ºä¿ç‹€æ…‹åŒæ­¥
                setTimeout(() => askAdminPassword(isRegistered), 500);
                initDataListeners();
            });
        }

        function askAdminPassword(isRegistered) {
            if (isRegistered) {
                // å·²ç¶“æ˜¯ç®¡ç†å“¡ï¼Œç›´æ¥å•Ÿç”¨
                enableAdminMode();
                return; 
            }

            let input = prompt(`æ­¡è¿ ${userNickname}ï¼\nè‹¥æ‚¨æ˜¯ç®¡ç†å“¡ï¼Œè«‹è¼¸å…¥å¯†ç¢¼ï¼š\n(ä¸€èˆ¬æˆå“¡è«‹æŒ‰å–æ¶ˆ)`);
            if (input === "Fire_Fire_54889427") { 
                alert("å¯†ç¢¼æ­£ç¢ºï¼Œç®¡ç†å“¡æ¨¡å¼å·²å•Ÿå‹•");
                enableAdminMode();
                // å¯«å…¥è³‡æ–™åº«
                db.ref('admins/' + myUid).set(true);
                db.ref('users/' + myUid).update({ role: 'admin' });
            } else {
                disableAdminMode();
            }
        }

        function enableAdminMode() {
            isAdmin = true;
            document.getElementById('msgWall').style.display = 'block';
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'flex');
            document.getElementById('menuBtn').innerHTML = '<i class="fa-solid fa-user-shield"></i> ç®¡ç†';
        }

        function disableAdminMode() {
            isAdmin = false;
            document.getElementById('msgWall').style.display = 'none';
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
            document.getElementById('menuBtn').innerHTML = '<i class="fa-solid fa-gear"></i> é¸å–®';
        }

        // --- è³‡æ–™ç›£è½ ---
        function initDataListeners() {
            // å…¬å‘Š
            db.ref('announcements/text').on('value', snap => {
                if(snap.val()) {
                    document.getElementById('publicAnnouncement').innerText = "ğŸ“¢ " + snap.val();
                    playSnd('sndDoorbell'); // å…¬å‘Šæ›´æ–° = é–€éˆ´è²
                }
            });

            // èŠå¤©
            db.ref('chat').limitToLast(50).on('child_added', snap => {
                const msg = snap.val();
                renderMessage(msg);
                if (Date.now() - msg.timestamp < 10000) playSnd('sndMSN'); // èŠå¤© = MSNè²
            });

            // ä½ç½®
            db.ref('users').on('value', snapshot => {
                const users = snapshot.val() || {};
                Object.keys(users).forEach(uid => {
                    if (users[uid].lat && users[uid].lng) updateMarker(uid, users[uid]);
                });
            });
        }

        // --- åŠŸèƒ½å‡½æ•¸ ---
        function setStatus(btn, status, color) {
            if(!myUid) return alert("è«‹å…ˆç™»å…¥");
            playSnd('sndBike'); // æ©Ÿèƒ½éµ = è‡ªè¡Œè»Šéˆ´è²
            db.ref('users/' + myUid).update({ status: status, color: color });
        }

        function setupPPT() {
            const btn = document.getElementById('pptBtn');
            const start = (e) => { 
                e.preventDefault(); 
                btn.classList.add('talking'); 
                playSnd('sndPtt'); // PPT = å—¶è²
            };
            const end = (e) => { 
                e.preventDefault(); 
                btn.classList.remove('talking'); 
            };
            btn.addEventListener('touchstart', start);
            btn.addEventListener('touchend', end);
            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', end);
        }

        function updateMarker(uid, data) {
            let latlng = [data.lat, data.lng];
            let icon = L.divIcon({
                className: 'custom-avatar',
                html: `<div class="status-label">${data.status || '...'}</div>
                       <div class="user-avatar-icon" style="background:${data.color || '#007bff'}">${data.nickname ? data.nickname[0] : '?'}</div>`
            });
            if (markers[uid]) markers[uid].setLatLng(latlng).setIcon(icon);
            else markers[uid] = L.marker(latlng, {icon: icon}).addTo(map);

            if (!polylines[uid]) polylines[uid] = L.polyline([], {color: 'blue', weight: 3}).addTo(map);
            polylines[uid].addLatLng(latlng);
        }

        function locateUser() {
            if(!myUid) return alert("è«‹å…ˆç™»å…¥");
            map.locate({setView: true, maxZoom: 16});
        }

        map.on('locationfound', e => {
            if(myUid) db.ref('users/' + myUid).update({ lat: e.latlng.lat, lng: e.latlng.lng });
        });

        function handleGoogleLogin() {
            if (myUid) { if(confirm("ç™»å‡º?")) auth.signOut().then(() => location.reload()); }
            else auth.signInWithPopup(provider);
        }

        function editAnnouncement() {
            // A. å…¬å‘Šç·¨è¼¯åŠŸèƒ½
            if(!isAdmin) return;
            let t = prompt("ä¿®æ”¹å…¬å‘Šå…§å®¹:");
            if(t) db.ref('announcements/text').set(t);
        }

        function linkify(text) {
            var urlRegex = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlRegex, function(url) {
                return '<a class="chat-link" href="' + url + '" target="_blank">' + url + '</a>';
            });
        }

        function renderMessage(msg) {
            const body = document.getElementById('chatBody');
            const div = document.createElement('div');
            div.style.marginBottom = "5px";
            let content = linkify(msg.text);
            div.innerHTML = `<strong>${msg.sender}:</strong> ${content}`;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        }

        function sendMsg() {
            let val = document.getElementById('msgInput').value;
            if(val && myUid) {
                db.ref('chat').push({ text: val, sender: userNickname, timestamp: firebase.database.ServerValue.TIMESTAMP });
                document.getElementById('msgInput').value = "";
            }
        }

        function loadGPX(input) {
             if (input.files && input.files[0]) {
                if(currentGpxLayer) map.removeLayer(currentGpxLayer);
                var reader = new FileReader(); 
                reader.onload = function(e) {
                    var blob = new Blob([e.target.result], {type: 'application/xml'});
                    var url = URL.createObjectURL(blob);
                    currentGpxLayer = new L.GPX(url, { async: true }).on('loaded', function(e) {
                        map.fitBounds(e.target.getBounds());
                    }).addTo(map);
                };
                reader.readAsText(input.files[0]);
                toggleMenu();
            }
        }

        function removeGPX() { if(currentGpxLayer) { map.removeLayer(currentGpxLayer); currentGpxLayer = null; alert("å·²æ¸…é™¤"); } }
        function toggleMenu() { document.getElementById('dropdownList').style.display = (document.getElementById('dropdownList').style.display==='flex')?'none':'flex'; }
        function toggleChat() { document.getElementById('chatWindow').style.display = (document.getElementById('chatWindow').style.display==='flex')?'none':'flex'; }
        function changeNickname() { let n = prompt("æš±ç¨±:", userNickname); if(n && myUid) db.ref('users/'+myUid).update({nickname:n}); }
        function playSnd(id) { try { document.getElementById(id).play(); } catch(e){} }
        function exportChatXLS() { alert("åŒ¯å‡ºèŠå¤©ç´€éŒ„ (åŠŸèƒ½é–‹ç™¼ä¸­)"); }
        function exportWallLogXLS() { alert("åŒ¯å‡ºè¨Šæ¯ç‰†ç´€éŒ„ (åŠŸèƒ½é–‹ç™¼ä¸­)"); }

        window.addEventListener('resize', function(){ if(map) map.invalidateSize(); });
    </script>
</body>
</html>
